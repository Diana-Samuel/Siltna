<!DOCTYPE html>

<html>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <head>
        <style>
            body {
                background-color: #0B0F1A;
                color: #0B0F1A;
            }
            #createPost {
                display: none;
            }
            .post {
                width: calc((100% / 4) * 1.618);
                height: fit-content;
                background-color: #3B82F6;
            }
            .postImage {
                display: grid;
                gap: 4px;
                margin-bottom: 1rem;
            }

            .postImage.one-image {
                grid-template-columns: 1fr;
            }

            .postImage.two-images {
                grid-template-columns: 1fr 1fr;
            }

            .postImage.three-images {
                grid-template-columns: 1fr 1fr;
                grid-template-rows: auto auto;
            }

            .postImage.four-images {
                grid-template-columns: 1fr 1fr;
            }

            .postImage img {
                width: 100%;
                height: auto;
                object-fit: cover;
                border-radius: 6px;
            }


        </style>
    </head>
    <body>
        <h2>{{ msg }}</h2>
        <button onclick="postPopup()">Create New Post</button>
        <div id="createPost">
            <form action="" method="POST" enctype="multipart/form-data">
                <div>
                    <input name="text" type="text">
                </div>
                <div>
                    <input name="file" type="file" multiple>
                </div>
                <input type="text" name="createpost" style="display: none;">
                <button type="submit" id="createPostSubmit">Create Post</button>
            </form>
        </div>
        <center>
            <div id="PostSection">

            </div>
        </center>
        <script>
            function postPopup() {
                const postpopup = document.querySelector("#createPost");
                postpopup.style.display = "block";
            }
            document.querySelector("#createPostSubmit").addEventListener("click", () => {
                const postpopup = document.querySelector("#createPost");
                postpopup.style.display = "none";
            })
            function AddPosts() {
                fetch("/getPosts")
                    .then(response => response.json())
                    .then(data => {
                        console.log(data);
                        if (data["status"] == "success") {
                            let posts = data["posts"];
                            let final = [];
                            posts.forEach(info => {
                                let post = info[1];
                                let text = post[0];
                                let images = post[1];
                                let postdate = post[2];
                                let postername = info[0][1]
                                let posterid = info[0][0]
                                let htmlPost = "<div class='post'><div class='posterInfo'><a href='/u/"
                                                +posterid+
                                                "'>"
                                                +postername+
                                                "</a><span>"
                                                +postdate+
                                                "</span></div><h3>"
                                                +text+
                                                "</h3><div class='postImages'>"
                                                +images+
                                                "</div></div>";
                                final.push(htmlPost);
                            });
                            document.querySelector("#PostSection").innerHTML += final.join("");
                        }
                    });
            }
            document.addEventListener("DOMContentLoaded",() => {
                AddPosts();
            })

            document.querySelectorAll('.postImage').forEach(post => {
                const count = post.querySelectorAll('img').length;

                // Clear any existing classes
                post.classList.remove('one-image', 'two-images', 'three-images', 'four-images');

                if (count === 1) {
                    post.classList.add('one-image');
                } else if (count === 2) {
                    post.classList.add('two-images');
                } else if (count === 3) {
                    post.classList.add('three-images');
                } else if (count >= 4) {
                    post.classList.add('four-images');
                }
            });
        </script>
    </body>
</html>